# CNNS H5小程序开放平台游戏快捷登录方案

* [概述](#概述)
* [方案特点](#方案特点)
* [方案说明](#方案说明)
   * [对接参数](##对接参数)
   * [接口参数](##接口参数)
   * [签名方法](##签名方法)
   * [参数验证](##验证方法)

## 概述
CNNS H5小程序开放平台是对外提供第三方H5 APP对接进CNNS 生态内各个APP能力的一个开放应用平台。本文档主要介绍一种游戏应用可以更快速进行接入的方案。
## 方案特点
本快捷登录方案，不需要第三方引入 JS-SDK ，也不需要调用服务端接口。只需要第三方提供一个专门的登录入口地址，接收并验证从 CNNS 平台传过来的登录参数即可。所有与客户端APP的交互与登录验证，将全部由开放平台实现。
## 方案说明
### 对接参数

|参数|类型|说明|
|--|--|--|
|app_key|string|用于数据签名的app_key，由平台提供给第三方，注意保密，此参数不可泄露|

### 接口参数
以下数据将作为 GET 方法的参数通过浏览器跳转的方式传给第三方提供的接口地址。

|参数|类型|说明|
|--|--|--|
|open_id|string|当前登录用户的open_id，可用于区分不同用户|
|nickname|string|当前登录用户的昵称|
|headimgurl|string|当前登录用户的头像|
|timestamp|int|当前服务器的时间戳（单位：秒）|
|pf_gid|string|需要进入的游戏编号（有第三方提供）|
|state|string|由第三方提供的额外参数，可为空|
|sign|string|签名信息，验证方法见下文说明|

### 签名方法
1. 将参数按 key=value 的形式组合成字符串；
2. 将产生的字符串按照 key 的升序排列，并用 & 拼接起来；
3. 在第2步产生的字符串后边拼接上平台提供的 app_key ；
4. 将第3步生成的字符串进行 md5 ；

### 参数验证
当第三方的地址接收到传过来的参数时，一定要做以下验证：

1. 验证时间戳( timestamp ) 是否在最近 10 秒内；
2. 验证签名是否正确；
3. 验证同一个用户 (open_id) 是否使用同一个时间戳(timestamp)重复请求过；

违反以上 3 点中任意一项，请拒绝用户登录，以便保护用户虚拟资产的安全。