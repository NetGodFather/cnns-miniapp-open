
# CNNS H5小程序开放平台(js端)

## 概述
CNNS H5小程序开放平台是对外提供第三方H5 APP对接进CNNS 生态内各个APP能力的一个开放应用平台。本文档主要介绍H5前端与APP交互的方法。

## 对接方式
我们为开发者提供了 JS SDK，通过在页面中引入 JS SDK 文件，可以在 JS 中调用 windows.cw 这个对象的各种方法，来实现与 APP 的交互通信。
### 请求参数
如果请求有参数，则所有参数都是通过 [object] 形式传入，例如：
   {
      appId：20190928123452678901234567,
      callback : function( re ){ }
   }

### 返回值
如果请求是同步的，将直接放回结果。如果请求方法有异步的，可以传入 callback 回调函数，当有返回的时候。回调函数会调用，并将返回值以 [object] 的方式返回。
回调返回对象格式如下：
   {
      code : xxx, // 状态码，如果为 0 表示业务执行成功；
      message:"", // 状态描述信息，用于调试阶段
      data : { …… } // 业务执行的返回（以下文档中标识的返回值都在这里边）
   }

### 返回方式

## 接口
### 检测是否在APP内
**请求方法：** isInApp()
**是否异步：** 否
**方法说明：** 检测是否在支持 H5 小程序的APP内（部分老版本不支持 H5 APP）。
**请求参数：**  (无)
**返回值：**  bool
> true : 在支持 CNNS H5 小程序的APP内； 
> false : 不在支持 CNNS H5 小程序的APP内；

### 获取当前APP信息
**请求方法：** getAppInfo()
**是否异步：** 否
**方法说明：** 返回当前APP的基本信息。
**请求参数：**  (无)
**返回值：**  
| 参数 | 类型 | 说明 |
|--|--|--|
| uuid | string | 设备识别码 |
| version | string | 版本号，如 2.9.0 |
| appName | string | APP名称，如：Bishijie |
| lang | string | 用户选择的语言 | 

### 授权登录
**请求方法：** cwLogin
**是否异步：** 否
**方法说明：** 返回当前APP的基本信息。
**请求参数：** 
| 参数 | 类型 | 说明 |
|--|--|--|
| appId | string | 由平台提供的编号 |
| callback | func | 登录成功/失败的回调函数 | 

> 参数通过 object 对象方式传入，如果不在支持的APP内，会返回 false ; 
> 登录成功/失败都会调用 callback 回调函数，返回相应值；

**返回值：**  
| 参数 | 类型 | 说明 |
|--|--|--|
| app_id | string | 应用编号  |
| code | string | 登录授权码，使用此 code 调用服务器端的 open.auth.token 接口可以获取当前登录用户的信息  |

### 收款订单支付确认
**请求方法：** cwPay
**是否异步：** 否
**方法说明：** 让APP 弹出支付确认窗口，让用确认是否。
**请求参数：** 
| 参数 | 类型 | 说明 |
|--|--|--|
| payId | string | 通过服务端 open.pay.inorder.create 创建收款订单时候 |
| callback | func | 支付成功或失败的回调函数 | 

> 参数通过 object 对象方式传入，如果不在支持的APP内，会返回 false ; 
> 登录成功/失败都会调用 callback 回调函数，返回相应值；

**返回值：**  
> 与服务端接口文档的 “in_order" 数据结构一致

### 设置横屏或者竖屏
**请求方法：** screenOrientation
**是否异步：** 是
**方法说明：** 将当前整个屏幕调整为横屏(portrait) 或者 竖屏 (landscape)
**请求参数：** 
| 参数 | 类型 | 说明 |
|--|--|--|
| orientation | string | 需要调整的方向，纵向 portrait，横向 landscape |
**返回值：** 
> 当屏幕调整成功后，会调用该回调函数。会直接返回当前的屏幕方向的字符串，纵向是 portrait，横向是 landscape。
